## 适用场景

CDN 加速适用于对 COS 存储桶中的内容进行下载、分发，特别是对于相同内容反复下载的使用场景。

## 相关说明

在默认配置的情况下，在腾讯云 CDN 绑定域名，并配置源站为对象存储 COS 中许可公共访问的存储桶后，用户可以直接使用 URL 访问到存储桶中的对象。

有关访问公共或私有存储桶，以及 CDN 鉴权等配置的选项和表现如下表：

| 存储桶访问权限    | CDN 回源鉴权 | CDN 鉴权配置 | 访问 CDN 域名   | 访问 COS 域名   | 场景         |
| ----------------- | ------------ | ------------ | --------------- | --------------- | ------------ |
| 公共访问          | 关闭         | 关闭         | 可访问          | 可访问          | 全站公共访问 |
| 公共访问          | 关闭         | 开启         | 需使用 URL 鉴权 | 可访问          | 不推荐       |
| 公共访问          | 开启，无意义 |              |                 | 可访问          | 不推荐       |
| 私有访问+服务授权 | 关闭，无意义 |              |                 | 需使用 COS 鉴权 | 不推荐       |
| 私有访问+服务授权 | 开启         | 关闭         | 可访问          | 需使用 COS 鉴权 | 源站保护     |
| 私有访问+服务授权 | 开启         | 开启         | 需使用 URL 鉴权 | 需使用 COS 鉴权 | 全链路保护   |
| 私有访问          |              |              | 不可访问        | 需使用 COS 鉴权 | 无法使用 CDN |

## 对默认域名配置 CDN 加速

### 默认加速域名

腾讯云会为需要 CDN 加速的存储桶自动分配一个默认加速域名，开启后可在存储桶的【域名管理】下看到，初始状态为关闭。![默认域名关闭](https://main.qcloudimg.com/raw/aa1d85144ec4f89f287d95094e66faf2.png)

### 开启 CDN 加速

**第一步：开启 CDN 加速**

在存储桶的【域名管理】下，会出现默认域名的当前状态，点击【编辑】，再点击”当前状态“旁边的按钮即可开启默认域名加速。此处可以选择源站类型和是否开启回源鉴权，源站类型通常默认是 XML 节点，如果作为源站的存储桶开启了静态网站，并且希望为静态网站加速，则可以将源站类型设置为静态网站节点。具体如下：

> 注意：如果用户在之前从未使用过腾讯云 CDN 服务，则无法进入【域名管理】，需先进入 CDN 控制台使用 CDN 服务。

![开启默认域名](https://main.qcloudimg.com/raw/64cd680bb9d3e03fee7dde5c05f9d3fa.png)

**第二步：添加 CDN 服务授权**

- 如果将存储桶设置为允许公共访问，配置 CDN 回源到 COS 访问节点时，CDN 边缘节点无需任何授权即可直接获取并缓存存储桶中的对象数据，因此可以不必为 CDN 加速域名添加服务授权，点击【保存】即可开启 CDN 加速。

- 如果将存储桶设置为私有访问，配置 CDN 回源到 COS 访问节点时，CDN 边缘节点将无法直接获取和缓存任何数据，因此需要【添加 CDN 服务授权】，在存储桶访问策略中加入 CDN 的服务身份，授予 CDN 边缘节点对于存储桶的操作权限，然后选择【我同意以上授权】并点击【确定】。此处有说明操作范围，用户访问时可以进行 GET Object，Head Object，Options Object 这三项操作。![CDN 授权](https://main.qcloudimg.com/raw/26d4f635553406d85f7e99a2fe87e3f9.png)

  同意授权之后，系统会自动在存储桶访问策略中对相应账户加入“service/cdn”标记，表示授予操作权限，之后该账户在使用中需要回源时无需再进行其他操作。

![授权服务](https://main.qcloudimg.com/raw/e5a39f1c38b46032f0fe8430e44285b6.png)

**第三步：开启回源鉴权**

- 对于允许公共访问的存储桶，CDN 边缘节点无需获得授权即可对存储桶进行访问，故也无需开启回源鉴权。
- 对于设置私有访问的存储桶，需要开启回源鉴权来识别 CDN 边缘节点的服务身份（即第二步的“service/cdn”标记），通过身份验证的 CDN 边缘节点才能对存储桶中对象数据进行操作。如果在第二步未添加 CDN 授权是无法开启回源鉴权的，请返回第二步添加授权，在第二步添加 CDN 服务授权之后，开启【回源鉴权】，并点击【保存】即可开启 CDN 加速。

![开启回源鉴权](https://main.qcloudimg.com/raw/9bf3808c008374ad97d2de31264a2b9c.png)

> 注意：对于私有存储桶，同时开启回源鉴权和 CDN 服务授权会导致通过 CDN 访问源站时无需携带签名，CDN 缓存资源会进行公网分发，导致数据的安全性受到影响，因此强烈建议开启 CDN 鉴权。

### 配置 CDN 鉴权

> 注意：CDN 鉴权是针对私有存储桶的数据保护措施，公有存储桶则无需配置。

**第一步：开启 CDN 鉴权**

点击【保存】之后，“默认加速域名”下会多一条 CDN 鉴权状态提示（对于隐私要求严格的数据，一定要开启 CDN 鉴权），可通过页面上【鉴权配置】直接跳转到对应域名的 CDN 安全配置页面进行配置，也可以通过 CDN 控制台进入，路径为【域名管理】>>对应域名的【管理】>>【安全配置】。![鉴权配置](https://main.qcloudimg.com/raw/6037e9e47562a913fff6c13a8ab79cb2.png)

点击“鉴权配置”旁边的按钮即可开始对 CDN 鉴权进行配置。

![开启鉴权配置](https://main.qcloudimg.com/raw/a04220ffdd7498df3ec6319c090b40af.png)

**第二步：CDN 鉴权配置**

鉴权 Key 可以自己设置也可以随机生成，要求是 6-32 个由大小写字母或数字组成的字符串。有效时间是鉴权 URL 能够生效的时长，由用户自己设置。设置完成之后点击【确定】。

![详细鉴权配置](https://main.qcloudimg.com/raw/88fdc821546ad36b905cc0f350e6dadc.png)

**第三步：计算鉴权 URL**

点击【鉴权计算器】，如果上一步已经配置好鉴权，鉴权 Key 和有效时间会自动填入，通常只用输入需要访问的对象的 Path，然后点击【生成】即可得到鉴权 URL，使用鉴权 URL 能直接访问到目标对象。

![鉴权计算器标志](https://main.qcloudimg.com/raw/7362294fd7bea6ff2e28843a996740c2.png)

![鉴权计算器](https://main.qcloudimg.com/raw/c3dd941a4100d39d7c093636b5ff40e3.png)

### 注意事项

在为默认域名启用 CDN 加速之后，任何人都可以通过此域名直接访问源站，所以如果您的数据有一定的私密性，请您务必通过鉴权配置来保护您的源站数据。

## 对自定义域名配置 CDN 加速

用户在托管网站时，根据使用需要，会更倾向于使用类似 ` www.<bucketname>.com` 的域名，而不希望类似 `<bucketname>-<APPID>.cos.<region>.myqcloud.com` 等域名显示在网站或服务上。对此，用户可以通过 COS 控制台为存储桶绑定自定义域名，绑定后可通过自定义域名直接访问存储桶。绑定自定义域名时，用户需自行在自定义域名的厂商处添加 CNAME 解析。

> **注意：** 绑定存储桶的自定义域名需在工信部 [备案](https://cloud.tencent.com/product/ba)，否则自定义域名将无法被访问。 

### 开启 CDN 加速

> 注意：此处仅介绍从 COS 控制台完成自定义域名添加及开启 CDN 加速，若要从 CDN 控制台添加自定义域名，可以参考 [域名接入](https://cloud.tencent.com/document/product/228/5734)。

**第一步：选择自定义域名要绑定的存储桶**

登录 [对象存储控制台](https://console.cloud.tencent.com/cos5) ，进入左侧菜单栏【存储桶列表】，单击需要配置域名的存储桶（如 example），进入存储桶。 ![存储桶界面](https://main.qcloudimg.com/raw/1ad8ad5a4a70ec21763fe313bf53bdfa.png)

**第二步：添加自定义域名**

从存储桶页面上方进入【域名管理】，在第二栏“自定义加速域名”处单击【添加域名】，输入待绑定的自定义域名（如 ` www.example.com`）。若域名要绑定的存储桶允许公共访问，CDN 边缘节点无需获得授权即可对存储桶进行访问，可不必开启回源鉴权，单击右侧的【保存】即可完成域名添加。若是域名要绑定的存储桶设置了私有访问，需要开启“回源鉴权”的按钮来保护源站，并点击【保存】即可完成域名添加。![自定义域名](https://main.qcloudimg.com/raw/cfda48bf50a39ce1a82ff9bf1fcf6940.png)

### 配置 CDN 鉴权

> 注意：CDN 鉴权是针对私有存储桶的数据保护措施，公有存储桶则无需配置。

**第一步：开启 CDN 加速鉴权**

保存自定义域名之后，CDN 鉴权栏会出现 CDN 鉴权功能开关，若是自定义域名绑定的存储桶设置了私有访问，请选择开启自定义域名 CDN 鉴权。

**第二步：CDN 鉴权配置**

登陆 [CDN 控制台](https://console.cloud.tencent.com/cdn/access)，进入左侧菜单栏【域名管理】，点击要配置的域名的【管理】，选择【安全配置】。鉴权 Key 可以自己设置也可以随机生成，要求是 6-32 个由大小写字母或数字组成的字符串。有效时间是鉴权 URL 能够生效的时长，由用户自己设置。设置完成之后点击【确定】。

![详细鉴权配置](https://main.qcloudimg.com/raw/88fdc821546ad36b905cc0f350e6dadc.png)

**第三步：计算鉴权 URL**

点击【鉴权计算器】，如果已经配置好鉴权，鉴权 Key 和有效时间会自动填入，通常只用输入需要访问的对象的 Path，然后点击【生成】即可得到鉴权 URL，使用鉴权 URL 能直接访问到目标对象。

![鉴权计算器标志](https://main.qcloudimg.com/raw/7362294fd7bea6ff2e28843a996740c2.png)

![鉴权计算器](https://main.qcloudimg.com/raw/c3dd941a4100d39d7c093636b5ff40e3.png)

### 注意事项

在为自定义域名启用 CDN 加速之后，任何人都可以通过此域名直接访问源站，所以如果您的数据有一定的私密性，请您务必通过鉴权配置来保护您的源站数据。